<?xml version="1.0" encoding="UTF-8"?>

<project name="Achivemenent System Manage - PHING" default="build">
    
    <target name="build"
            description="Build system. It's default target"
            depends="clean">
        <echo message="Run phpunit" />
        <exec
            command="vendor/bin/phpunit -c module/Achievement/test/phpunit.xml"
            passthru="true"
            logoutput="true" />
    </target>

    <target name="dev-off"
            description="Show debug toolbar. Use in development environment only">
        <echo message="Show debug toolbar. Use in development environment only" />
        <exec command="php public/index.php development disable" />
    </target>

    <target name="dev-on"
            description="Disable debug toolbar. Recomended use in produciton environment.">
        <echo message="Disable debug toolbar. Recomended use in produciton environment." />
        <exec command="php public/index.php development enable" />
    </target>

    <target name="clean"
            description="Remove all temp dir">
        <echo message="Remove test log folder 'module/Achievement/test/logs'" />
        <delete dir="module/Achievement/test/logs"
                includeemptydirs="true"/>
        <echo message="Remove test coverage folder 'module/Achievement/test/coverage'" />
        <delete dir="module/Achievement/test/coverage"
                includeemptydirs="true"/>
    </target>

    <target name="phpcs"
            description="Validation coding standard psr2">
        <phpcodesniffer
            standard="PSR2"
            description="Run PSR2 standards over the codebase"
            haltonerror="true">
            <fileset dir="module">
                <include name="**/*.php"/>
            </fileset>
            <formatter type="full" usefile="false"/>
        </phpcodesniffer>
    </target>
    
    <target name="agiledoc"
            description="Phpunit generator agile doc"
            depends="clean">
            <echo message="Generator agile document" />
            <exec
            command="vendor/bin/phpunit --testdox -c module/Achievement/test/phpunit.xml"
            passthru="true"
            logoutput="true" />
    </target>

    <target name="phpunit"
            description="Phpunit debug"
            depends="clean">
            <echo message="Phpunit debug" />
            <exec
            command="vendor/bin/phpunit --verbose -c module/Achievement/test/phpunit.xml"
            passthru="true"
            logoutput="true" />
    </target>

    <target depends="clean" description="Install dependencies with Composer" name="composer">
        <tstamp>
            <format offset="-30" pattern="MM/dd/yyyy hh:mm aa" property="thirty.days.ago" unit="day"/>
        </tstamp>
        <echo message="${thirty.days.ago}" />
    </target>

    <target description="Update code" name="update">
        <exec command="git pull" />
        <exec executable="vendor/bin/phinx migrate -e testing" />
        <phingcall target="phpunit" />
    </target>

</project>
