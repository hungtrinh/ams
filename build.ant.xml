<?xml version="1.0" encoding="UTF-8"?>
<project default="build" name="Achivemenent System Manage - Ant">
    <target depends="clean,composer" name="build" />
    <target description="Run phpunit verbose" name="phpunit">
        <exec executable="vendor/bin/phpunit">
            <arg value="--verbose"/>
            <arg value="-c"/>
            <arg value="module/Achievement/test/phpunit.xml"/>
        </exec>
    </target>
    <target description="Development mode off" name="dev-off">
        <exec executable="php">
            <arg value="public/index.php"/>
            <arg value="development"/>
            <arg value="disable"/>
        </exec>
    </target>
    <target description="Development mode off" name="dev-on">
        <exec executable="php">
            <arg value="public/index.php"/>
            <arg value="development"/>
            <arg value="enable"/>
        </exec>
    </target>
    <target description="Cleanup build artifacts" name="clean">
        <echo message="Remove test log folder 'module/Achievement/test/logs'"/>
        <delete dir="module/Achievement/test/logs" includeemptydirs="true"/>
        <echo message="Remove test coverage folder 'module/Achievement/test/coverage'"/>
        <delete dir="module/Achievement/test/coverage" includeemptydirs="true"/>
        <delete dir="${basedir}/vendor"/>
        <delete file="${basedir}/composer.lock"/>
    </target>
    <target description="Open phpunit report. Run on MAC OS only" name="open-report">
        <exec executable="firefox">
            <arg value="module/Achievement/test/coverage/index.html"/>
        </exec>
        <exec executable="firefox">
            <arg value="module/Achievement/test/coverage/testdox.html"/>
        </exec>
    </target>
    <target description="Phpunit generate agile document" name="agiledoc">
        <exec executable="vendor/bin/phpunit">
            <arg value="--testdox"/>
            <arg value="-c"/>
            <arg value="module/Achievement/test/phpunit.xml"/>
        </exec>
    </target>
    <target depends="clean" description="Install dependencies with Composer" name="composer">
        <tstamp>
            <format offset="-30" pattern="MM/dd/yyyy hh:mm aa" property="thirty.days.ago" unit="day"/>
        </tstamp>
        <delete>
            <fileset dir="${basedir}">
                <include name="composer.phar"/>
                <date datetime="${thirty.days.ago}" when="before"/>
            </fileset>
        </delete>
        <get dest="${basedir}/composer.phar" skipexisting="true" src="https://getcomposer.org/composer.phar"/>
        <exec executable="php">
            <arg value="composer.phar"/>
            <arg value="install"/>
            <arg value="--prefer-dist"/>
            <arg value="-o"/>
        </exec>
    </target>
</project>